<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>Kiválasztásos Rendezés Vizualizáció</title>

    <!-- Include Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Include React and ReactDOM from CDN -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Include Babel for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Helvetica, Arial, sans-serif;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div
      id="root"
      class="container"></div>

    <script type="text/babel">
      const {useState, useEffect} = React;

      function SelectionSortVisualization() {
        const [array, setArray] = useState([]);
        const [sortedIndex, setSortedIndex] = useState(0);
        const [currentIndex, setCurrentIndex] = useState(1);
        const [minIndex, setMinIndex] = useState(0);
        const [isSorting, setIsSorting] = useState(false);
        const [completed, setCompleted] = useState(false);
        const [speed, setSpeed] = useState(500);
        const [history, setHistory] = useState([]);
        const [historyIndex, setHistoryIndex] = useState(-1);
        const [autoPlay, setAutoPlay] = useState(false);
        const [comparisons, setComparisons] = useState(0);
        const [swaps, setSwaps] = useState(0);
        const [currentStep, setCurrentStep] = useState('Indításra kész');

        const generateRandomArray = () => {
          const newArray = Array.from(
            {length: 10},
            () => Math.floor(Math.random() * 100) + 1
          );
          setArray(newArray);
          setSortedIndex(0);
          setCurrentIndex(1);
          setMinIndex(0);
          setCompleted(false);
          setComparisons(0);
          setSwaps(0);
          setCurrentStep('Indításra kész');

          // Initialize history
          const initialState = {
            array: [...newArray],
            sortedIndex: 0,
            currentIndex: 1,
            minIndex: 0,
            completed: false,
            comparisons: 0,
            swaps: 0,
            currentStep: 'Indításra kész',
          };
          setHistory([initialState]);
          setHistoryIndex(0);
        };

        useEffect(() => {
          generateRandomArray();
        }, []);

        const resetDemo = () => {
          setIsSorting(false);
          setAutoPlay(false);
          if (history.length > 0) {
            const initialState = history[0];
            setArray([...initialState.array]);
            setSortedIndex(initialState.sortedIndex);
            setCurrentIndex(initialState.currentIndex);
            setMinIndex(initialState.minIndex);
            setCompleted(initialState.completed);
            setHistoryIndex(0);
            setComparisons(0);
            setSwaps(0);
            setCurrentStep('Indításra kész');
          }
        };

        const selectionSortStep = () => {
          if (completed) return;

          let newArray = [...array];
          let newSortedIndex = sortedIndex;
          let newCurrentIndex = currentIndex;
          let newMinIndex = minIndex;
          let newCompleted = completed;
          let newComparisons = comparisons;
          let newSwaps = swaps;
          let newStep = '';

          // If we're still scanning the array for the minimum value
          if (newCurrentIndex < newArray.length) {
            newComparisons++;
            newStep = `${newArray[newCurrentIndex]} és ${newArray[newMinIndex]} elemek összehasonlítása`;

            if (newArray[newCurrentIndex] < newArray[newMinIndex]) {
              newMinIndex = newCurrentIndex;
            }
            newCurrentIndex++;
          }
          // If we've found the minimum value for this pass
          else {
            // Swap if needed
            if (newMinIndex !== newSortedIndex) {
              newStep = `${newArray[newSortedIndex]} és ${newArray[newMinIndex]} elemek cseréje`;
              const temp = newArray[newSortedIndex];
              newArray[newSortedIndex] = newArray[newMinIndex];
              newArray[newMinIndex] = temp;
              newSwaps++;
            } else {
              newStep = `${newArray[newSortedIndex]} már a helyén van`;
            }

            // Move to next pass
            newSortedIndex++;

            // Check if sorting is complete
            if (newSortedIndex >= newArray.length - 1) {
              newCompleted = true;
              newStep = 'Rendezés befejezve!';
              setIsSorting(false);
              setAutoPlay(false);
            } else {
              newMinIndex = newSortedIndex;
              newCurrentIndex = newSortedIndex + 1;
            }
          }

          setArray(newArray);
          setSortedIndex(newSortedIndex);
          setCurrentIndex(newCurrentIndex);
          setMinIndex(newMinIndex);
          setCompleted(newCompleted);
          setComparisons(newComparisons);
          setSwaps(newSwaps);
          setCurrentStep(newStep);

          // Add to history
          const newHistoryState = {
            array: [...newArray],
            sortedIndex: newSortedIndex,
            currentIndex: newCurrentIndex,
            minIndex: newMinIndex,
            completed: newCompleted,
            comparisons: newComparisons,
            swaps: newSwaps,
            currentStep: newStep,
          };

          const newHistory = history
            .slice(0, historyIndex + 1)
            .concat(newHistoryState);
          setHistory(newHistory);
          setHistoryIndex(historyIndex + 1);
        };

        const startSorting = () => {
          if (!completed) {
            setIsSorting(true);
            setAutoPlay(true);
          }
        };

        const pauseSorting = () => {
          setAutoPlay(false);
        };

        const stepForward = () => {
          if (historyIndex < history.length - 1) {
            const nextState = history[historyIndex + 1];
            setArray([...nextState.array]);
            setSortedIndex(nextState.sortedIndex);
            setCurrentIndex(nextState.currentIndex);
            setMinIndex(nextState.minIndex);
            setCompleted(nextState.completed);
            setHistoryIndex(historyIndex + 1);
            setComparisons(nextState.comparisons);
            setSwaps(nextState.swaps);
            setCurrentStep(nextState.currentStep);
          } else {
            selectionSortStep();
          }
        };

        const stepBackward = () => {
          if (historyIndex > 0) {
            const prevState = history[historyIndex - 1];
            setArray([...prevState.array]);
            setSortedIndex(prevState.sortedIndex);
            setCurrentIndex(prevState.currentIndex);
            setMinIndex(prevState.minIndex);
            setCompleted(prevState.completed);
            setHistoryIndex(historyIndex - 1);
            setComparisons(prevState.comparisons);
            setSwaps(prevState.swaps);
            setCurrentStep(prevState.currentStep);
          }
        };

        useEffect(() => {
          let timer;
          if (autoPlay && !completed) {
            timer = setTimeout(() => {
              selectionSortStep();
            }, speed);
          }
          return () => clearTimeout(timer);
        }, [array, currentIndex, autoPlay, speed, completed]);

        const getBarColor = (index) => {
          if (completed) return 'bg-green-500';
          if (index < sortedIndex) return 'bg-green-500'; // Sorted elements
          if (index === minIndex) return 'bg-red-500'; // Current minimum
          if (index === currentIndex) return 'bg-yellow-500'; // Element being compared
          if (index === sortedIndex) return 'bg-purple-500'; // Current position
          return 'bg-blue-500'; // Unsorted elements
        };

        return (
          <div className="flex flex-col p-4 bg-gray-100 rounded-lg shadow-md">
            <h2 className="text-2xl font-bold text-center mb-4">
              Kiválasztásos Rendezés Vizualizáció
            </h2>

            <div className="mb-4 p-2 bg-white rounded shadow">
              <h3 className="text-lg font-semibold mb-2">
                Hogyan működik a kiválasztásos rendezés:
              </h3>
              <p className="text-sm mb-1">
                1. Megkeresi a legkisebb elemet a tömb rendezetlen részében
              </p>
              <p className="text-sm mb-1">
                2. Felcseréli az első rendezetlen elemmel
              </p>
              <p className="text-sm mb-1">
                3. Időbonyolultság: O(n²) minden esetben (legjobb, átlagos,
                legrosszabb)
              </p>
            </div>

            <div className="h-64 flex items-end justify-center space-x-1 mb-6 border-b-2 border-gray-400 bg-white rounded p-2">
              {array.map((value, index) => (
                <div
                  key={index}
                  className={`w-8 flex flex-col items-center justify-end ${getBarColor(
                    index
                  )} transition-all duration-300`}
                  style={{height: `${Math.max(value * 2, 24)}px`}}>
                  <div className="text-white font-bold mb-1">{value}</div>
                </div>
              ))}
            </div>

            <div className="text-center mb-4 bg-white p-2 rounded shadow">
              <p className="text-sm font-semibold">{currentStep}</p>
            </div>

            <div className="mb-4 flex justify-between items-center">
              <div className="flex space-x-2">
                <button
                  onClick={generateRandomArray}
                  className="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                  Új Tömb
                </button>
                <button
                  onClick={resetDemo}
                  className="px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">
                  Újraindítás
                </button>
              </div>

              <div className="flex space-x-2">
                <button
                  onClick={stepBackward}
                  disabled={historyIndex <= 0}
                  className={`px-3 py-1 rounded ${
                    historyIndex <= 0
                      ? 'bg-gray-300 cursor-not-allowed'
                      : 'bg-purple-500 text-white hover:bg-purple-600'
                  }`}>
                  ◀
                </button>

                {autoPlay ? (
                  <button
                    onClick={pauseSorting}
                    className="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">
                    Szünet
                  </button>
                ) : (
                  <button
                    onClick={startSorting}
                    disabled={completed}
                    className={`px-3 py-1 rounded ${
                      completed
                        ? 'bg-gray-300 cursor-not-allowed'
                        : 'bg-green-500 text-white hover:bg-green-600'
                    }`}>
                    Indítás
                  </button>
                )}

                <button
                  onClick={selectionSortStep}
                  disabled={completed}
                  className={`px-3 py-1 rounded ${
                    completed
                      ? 'bg-gray-300 cursor-not-allowed'
                      : 'bg-teal-500 text-white hover:bg-teal-600'
                  }`}>
                  Lépés
                </button>

                <button
                  onClick={stepForward}
                  disabled={completed && historyIndex >= history.length - 1}
                  className={`px-3 py-1 rounded ${
                    completed && historyIndex >= history.length - 1
                      ? 'bg-gray-300 cursor-not-allowed'
                      : 'bg-purple-500 text-white hover:bg-purple-600'
                  }`}>
                  ▶
                </button>
              </div>

              <div className="flex items-center">
                <span className="mr-2 text-sm">Sebesség:</span>
                <input
                  type="range"
                  min="50"
                  max="1000"
                  step="50"
                  value={1050 - speed}
                  onChange={(e) => setSpeed(1050 - parseInt(e.target.value))}
                  className="w-24"
                />
              </div>
            </div>

            <div className="grid grid-cols-3 gap-4 text-center bg-white p-2 rounded shadow">
              <div>
                <p className="text-sm font-semibold">
                  Átfutások:{' '}
                  <span className="text-blue-600">{sortedIndex + 1}</span>
                </p>
              </div>
              <div>
                <p className="text-sm font-semibold">
                  Összehasonlítások:{' '}
                  <span className="text-blue-600">{comparisons}</span>
                </p>
              </div>
              <div>
                <p className="text-sm font-semibold">
                  Cserék: <span className="text-green-600">{swaps}</span>
                </p>
              </div>
              <div className="col-span-3 mt-2">
                <div className="flex justify-center space-x-4">
                  <div className="flex items-center">
                    <div className="w-4 h-4 bg-green-500 mr-1"></div>
                    <span className="text-xs">Rendezett</span>
                  </div>
                  <div className="flex items-center">
                    <div className="w-4 h-4 bg-purple-500 mr-1"></div>
                    <span className="text-xs">Aktuális pozíció</span>
                  </div>
                  <div className="flex items-center">
                    <div className="w-4 h-4 bg-red-500 mr-1"></div>
                    <span className="text-xs">Jelenlegi minimum</span>
                  </div>
                  <div className="flex items-center">
                    <div className="w-4 h-4 bg-yellow-500 mr-1"></div>
                    <span className="text-xs">Összehasonlítás</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<SelectionSortVisualization />);
    </script>
  </body>
</html>
